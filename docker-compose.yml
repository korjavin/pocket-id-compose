version: '3.8'

services:
  pocket-id:
    image: ghcr.io/pocket-id/pocket-id:v1.14.2
    container_name: pocket-id
    restart: unless-stopped
    environment:
      - DB_PROVIDER=postgres
      - DB_CONNECTION_STRING=postgresql://pocket-id:pocket-id@db:5432/pocket-id?sslmode=disable
      - APP_URL=https://${POCKET_ID_HOST}
      - PORT=${POCKET_ID_PORT}
      - POCKET_ID_LOG_LEVEL=${POCKET_ID_LOG_LEVEL}
      - POCKET_ID_OIDC_CLIENT_ID=${POCKET_ID_OIDC_CLIENT_ID}
      - POCKET_ID_OIDC_CLIENT_SECRET=${POCKET_ID_OIDC_CLIENT_SECRET}
      - POCKET_ID_OIDC_REDIRECT_URI=${POCKET_ID_OIDC_REDIRECT_URI}
      - POSTGRES_USER=pocket-id
      - POSTGRES_PASSWORD=pocket-id
      - POSTGRES_DB=pocket-id
    networks:
      - pocket-id-network

  db:
    image: postgres:15-alpine
    container_name: pocket-id-db
    restart: unless-stopped
    environment:
      - POSTGRES_USER=pocket-id
      - POSTGRES_PASSWORD=pocket-id
      - POSTGRES_DB=pocket-id
    volumes:
      - pocket-id-data:/var/lib/postgresql/data
    networks:
      - pocket-id-network

networks:
  pocket-id-network:
    driver: bridge

volumes:
  pocket-id-data:
